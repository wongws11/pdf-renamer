Metadata-Version: 2.4
Name: pdf-renamer
Version: 1.2.0
Summary: AI-powered PDF document classification and automatic renaming using vision-language models
Author-email: Wing Wong <wongwsme@gmail.com>
License: MIT
Project-URL: Homepage, https://github.com/wongws11/pdf-renamer
Project-URL: Documentation, https://github.com/wongws11/pdf-renamer#readme
Project-URL: Repository, https://github.com/wongws11/pdf-renamer.git
Project-URL: Bug Tracker, https://github.com/wongws11/pdf-renamer/issues
Keywords: pdf,document-management,automation,ai,vision-model,document-classification
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: End Users/Desktop
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Topic :: Office/Business
Classifier: Topic :: Utilities
Classifier: Operating System :: MacOS
Classifier: Operating System :: POSIX :: Linux
Classifier: Operating System :: Microsoft :: Windows
Requires-Python: >=3.13
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: Pillow>=10.0.0
Requires-Dist: pdf2image>=1.16.3
Requires-Dist: huggingface-hub>=0.23.0
Requires-Dist: llama-cpp-python>=0.3.16
Provides-Extra: test
Requires-Dist: pytest>=7.0.0; extra == "test"
Requires-Dist: pytest-mock>=3.10.0; extra == "test"
Dynamic: license-file

# PDF Renamer ðŸ“„âœ¨

[![Python 3.13+](https://img.shields.io/badge/python-3.13+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

Automatically rename PDFs and images using a vision-language model (Qwen2.5-VL) running locally. Perfect for organizing document collections without cloud dependencies.

## Key Features

- **Local AI Processing**: Uses Qwen2.5-VL directly via `llama.cpp` for privacy and offline usage. No external API keys needed.
- **Auto-Download**: Automatically fetches the required models from HuggingFace (`unsloth/Qwen2.5-VL-3B-Instruct-GGUF`).
- **High Accuracy**: Specifically optimized for reading and summarizing invoices, receipts, and forms.
- **Smart Formatting**: Extracts dates, descriptions, and IDs into consistent filenames (`YYYY-MM-DD_Description_ID.pdf`).
- **Receipt Mode**: specialized formatting for thermal receipts.
- **Fast Caching**: SQLite-backed caching prevents re-analyzing identical files, saving time on subsequent runs.
- **Multi-threaded**: Processes multiple files simultaneously for significantly better throughput.

## Prerequisites

- **Python 3.13+**
- **Poppler**: Required for converting PDF pages to images.

### Installing Poppler

**macOS (Homebrew)**
```bash
brew install poppler
```

**Ubuntu/Debian**
```bash
sudo apt-get install poppler-utils
```

**Windows**
Download and extract the latest [poppler-windows](https://github.com/oschwartz10612/poppler-windows/releases/), and add the `bin/` directory to your system PATH.

## Installation

```bash
# Clone the repository
git clone https://github.com/wongws11/pdf-renamer.git
cd pdf-renamer

# Create virtual environment
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate

# Install the application
pip install -e .
```

## Quick Start

Run the tool on a single file or a directory of PDFs:

```bash
# Dry run on a single file (preview changes)
pdf-renamer document.pdf

# Actually rename the file
pdf-renamer document.pdf -e

# Process an entire directory of PDFs recursively and apply changes
pdf-renamer ./invoices/ -e -r
```

*Note: On the first run, it will download the Qwen2.5-VL model (approx. 2GB).*

## Command Line Arguments

| Argument | Short | Type | Default | Description |
|----------|-------|------|---------|-------------|
| `input_path` | â€” | Path | â€” | **Required.** Input directory or PDF/JPG/PNG file path |
| `--output` | `-o` | Path | Same as input | Output directory for renamed files |
| `--execute` | `-e` | Flag | False | Actually rename files (default is dry-run mode) |
| `--recursive` | `-r` | Flag | False | Recursively process files in subdirectories |
| `--receipt` | â€” | Flag | False | Receipt mode: use `date_storename_description_id` format |
| `--verbose` | `-v` | Flag | False | Enable verbose logging (shows model loading details) |
| `--delay` | `-d` | Float | 0.5 | Delay between file processing in seconds |
| `--workers` | `-w` | Integer | 4 | Number of worker threads for parallel processing |
| `--save-log` | â€” | Path | â€” | Save processing results to JSON file |
| `--no-cache` | â€” | Flag | False | Disable cache (re-analyze all PDFs, slower) |
| `--cache-path` | â€” | Path | `pdf_cache.db` | Custom path to cache database |
| `--cache-stats` | â€” | Flag | False | Show cache statistics and exit |
| `--no-image` | â€” | Flag | False | Exclude JPG and PNG files from processing |

### Examples

```bash
# Process all PDFs in a directory (dry-run)
pdf-renamer ./documents/

# Process and rename files
pdf-renamer ./documents/ -e

# Process recursively with custom output directory
pdf-renamer ./documents/ -e -r -o ./renamed/

# Process receipts with receipt-specific format
pdf-renamer ./receipts/ -e --receipt

# Verbose output with custom delay between files
pdf-renamer ./documents/ -e -v --delay 1.0

# Process with custom number of workers
pdf-renamer ./documents/ -e -w 8

# Save results to JSON and use custom cache location
pdf-renamer ./documents/ -e --save-log results.json --cache-path /tmp/cache.db

# Show cache statistics
pdf-renamer --cache-stats

# Force re-analysis (skip cache)
pdf-renamer ./documents/ -e --no-cache

# Exclude images from processing
pdf-renamer ./mixed_files/ -e --no-image
```

## Architecture & Code Structure

The project is structured into modular components:

- `cli.py` & `main.py`: CLI parsing and program entry point
- `renamer.py`: Orchestrates the renaming logic and handles cache interactions
- `pdf_utils.py`: Contains core utilities including the `LLMAnalyzer` (managing the `llama-cpp-python` session) and file operations
- `stats.py`: Tracks success/failure/skip statistics
- `logger.py`: Custom logging utility

## Troubleshooting

### Model Loading Error

```
ERROR: Model failed to load!
```
**Solution**: Ensure you have enough disk space (at least 3GB free) and that your system meets the requirements for running local LLMs. If the download is interrupted, clearing your Hugging Face cache (`~/.cache/huggingface/hub/`) and retrying may help.

### PDF2Image Error
```
pdf2image.exceptions.PDFInfoNotInstalledError: Unable to get page count.
```
**Solution**: This happens when Poppler is not installed or not in your system PATH. See the Prerequisites section above.

## Acknowledgements

- [HuggingFace](https://huggingface.co/) - For model distribution
- [llama.cpp](https://github.com/ggerganov/llama.cpp) & [llama-cpp-python](https://github.com/abetlen/llama-cpp-python) - For running local LLMs efficiently
- [Qwen](https://qwenlm.github.io/) - For their incredible open source vision models
